import { randomUUID } from 'crypto';
import type { UserEntityItem } from '../../src/infrastructure/dynamodb/user.entity';

export const uploadLogoTestData = {
  createEmployerUser: (overrides?: Partial<UserEntityItem>): UserEntityItem => {
    const userId = randomUUID();
    return {
      userId,
      email: `employer-logo-${Date.now()}@test.com`,
      password: 'hashedPassword123',
      role: 'employer',
      name: 'Test Employer',
      companyName: 'Test Company Inc',
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
      ...overrides,
    };
  },

  createPngBuffer: (): Buffer => {
    return Buffer.from([
      0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a, 0x00, 0x00, 0x00, 0x0d, 0x49, 0x48, 0x44,
      0x52, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x08, 0x06, 0x00, 0x00, 0x00, 0x1f,
      0x15, 0xc4, 0x89, 0x00, 0x00, 0x00, 0x0d, 0x49, 0x44, 0x41, 0x54, 0x78, 0x9c, 0x62, 0xf8,
      0x0f, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 0x1b, 0xb6, 0xee, 0x56, 0x00, 0x00, 0x00, 0x00,
      0x49, 0x45, 0x4e, 0x44, 0xae, 0x42, 0x60, 0x82,
    ]);
  },

  createJpegBuffer: (): Buffer => {
    return Buffer.from([
      0xff, 0xd8, 0xff, 0xe0, 0x00, 0x10, 0x4a, 0x46, 0x49, 0x46, 0x00, 0x01, 0x01, 0x00, 0x00,
      0x01, 0x00, 0x01, 0x00, 0x00, 0xff, 0xdb, 0x00, 0x43, 0x00, 0x08, 0x06, 0x06, 0x07, 0x06,
      0x05, 0x08,
    ]);
  },

  createGifBuffer: (): Buffer => {
    return Buffer.from([
      0x47, 0x49, 0x46, 0x38, 0x39, 0x61, 0x01, 0x00, 0x01, 0x00, 0x80, 0x00, 0x00, 0xff, 0xff,
      0xff, 0x00, 0x00, 0x00, 0x21, 0xf9, 0x04, 0x01, 0x0a, 0x00, 0x01, 0x00, 0x2c, 0x00, 0x00,
      0x00, 0x00,
    ]);
  },
};

export class UploadLogoAssertions {
  static assertValidUploadResult(result: any): void {
    expect(result).toBeDefined();
    expect(result?.companyLogoUrl).toBeTruthy();
    expect(result?.companyLogoUrl).toContain('s3://');
  }

  static assertValidS3Url(url: string, expectedKey: string): void {
    expect(url).toMatch(/^s3:\/\/.+\//);
    expect(url).toContain(expectedKey);
  }

  static assertCorrectFileExtension(url: string, mimeType: string): void {
    const ext = url.split('.').pop()?.toLowerCase();
    if (mimeType === 'image/png') {
      expect(ext).toBe('png');
    } else if (mimeType === 'image/jpeg') {
      expect(ext).toBe('jpg');
    } else if (mimeType === 'image/gif') {
      expect(ext).toBe('gif');
    }
  }
}
